#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æµ‹è¯•ä¸¥æ ¼éªŒè¯è§„åˆ™
éªŒè¯extract_numbers()æ–¹æ³•çš„æ–°éªŒè¯é€»è¾‘
"""

import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from text_processor import TextProcessor, VoiceCommandProcessor


def test_strict_validation():
    """æµ‹è¯•ä¸¥æ ¼éªŒè¯è§„åˆ™"""
    processor = TextProcessor()
    command_processor = VoiceCommandProcessor()

    print("ğŸ§ª æµ‹è¯•ä¸¥æ ¼éªŒè¯è§„åˆ™")
    print("=" * 60)

    # æµ‹è¯•ç”¨ä¾‹ï¼š(åŸå§‹æ–‡æœ¬, å¤„ç†åæ–‡æœ¬, æœŸæœ›ç»“æœ, è¯´æ˜)
    test_cases = [
        # æµ‹è¯•1ï¼šçº¯æ•°å­—è¾“å…¥ï¼Œåº”è¯¥æå–
        ("200", "200", [200.0], "çº¯æ•°å­—è¾“å…¥åº”è¯¥æå–"),

        # æµ‹è¯•2ï¼šçº¯æ•°å­—è¾“å…¥ï¼ˆ1300ï¼‰ï¼Œåº”è¯¥æå–
        ("1300", "1300", [1300.0], "çº¯æ•°å­—è¾“å…¥ï¼ˆ1300ï¼‰åº”è¯¥æå–"),

        # æµ‹è¯•3ï¼šæ–‡æœ¬ä¸­çš„100å€æ•°ï¼Œä¸åº”è¯¥æå–
        ("åƒé¥­200", "åƒé¥­200", [], "æ–‡æœ¬ä¸­çš„100å€æ•°ä¸åº”è¯¥æå–"),

        # æµ‹è¯•4ï¼šæ–‡æœ¬ä¸­çš„300å€æ•°ï¼Œä¸åº”è¯¥æå–
        ("ä»·æ ¼ä¸º300å…ƒ", "ä»·æ ¼ä¸º300å…ƒ", [], "æ–‡æœ¬ä¸­çš„300å€æ•°ä¸åº”è¯¥æå–"),

        # æµ‹è¯•5ï¼šçº¯æ•°å­—50ï¼ˆä¸æ˜¯100å€æ•°ï¼‰ï¼Œåº”è¯¥æå–
        ("50", "50", [50.0], "çº¯æ•°å­—50åº”è¯¥æå–"),

        # æµ‹è¯•6ï¼šå¤šä¸ªæ•°å­—ï¼ˆæ··åˆï¼‰
        ("ä»·æ ¼200é•¿åº¦50", "ä»·æ ¼200é•¿åº¦50", [50.0], "æ··åˆæ•°å­—åªæå–é100å€æ•°"),

        # æµ‹è¯•7ï¼šæ ‡å‡†åºå·å‘½ä»¤ï¼ˆé€šè¿‡éªŒè¯ï¼‰
        ("åˆ‡æ¢åˆ°200", "åˆ‡æ¢åˆ°200", [], "æ ‡å‡†åºå·å‘½ä»¤ä¸åº”è¢«æå–"),

        # æµ‹è¯•8ï¼šä¸­æ–‡æ•°å­—è½¬æ¢åçš„æ–‡æœ¬
        ("äºŒç™¾", "200", [200.0], "ä¸­æ–‡æ•°å­—è½¬æ¢ä¸ºçº¯æ•°å­—åº”è¯¥æå–"),

        # æµ‹è¯•9ï¼šæ–‡æœ¬ä¸­çš„ä¸­æ–‡æ•°å­—è½¬æ¢ç»“æœ
        ("é•¿åº¦äºŒç™¾", "é•¿åº¦200", [], "æ–‡æœ¬ä¸­çš„ä¸­æ–‡æ•°å­—è½¬æ¢ç»“æœä¸åº”è¯¥æå–"),
    ]

    passed = 0
    failed = 0

    for i, (original, processed, expected, description) in enumerate(test_cases, 1):
        print(f"\nğŸ“ æµ‹è¯• {i}: {description}")
        print(f"   åŸå§‹æ–‡æœ¬: '{original}'")
        print(f"   å¤„ç†å:   '{processed}'")

        result = processor.extract_numbers(original, processed, command_processor)

        if result == expected:
            print(f"   âœ… é€šè¿‡: æå–åˆ° {result}")
            passed += 1
        else:
            print(f"   âŒ å¤±è´¥: æœŸæœ› {expected}, å®é™…å¾—åˆ° {result}")
            failed += 1

    print("\n" + "=" * 60)
    print(f"ğŸ“Š æµ‹è¯•ç»“æœ: {passed} é€šè¿‡, {failed} å¤±è´¥")

    if failed == 0:
        print("âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ä¸¥æ ¼éªŒè¯è§„åˆ™å·¥ä½œæ­£å¸¸")
    else:
        print("âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥")

    return failed == 0


if __name__ == "__main__":
    test_strict_validation()
