# 语音系统集成测试文档

## 概述

本文档描述了语音系统的集成测试套件，提供了多种测试方式来验证语音识别、语音命令、数字提取和TTS功能。

## 测试文件说明

### 主要集成测试

1. **`integration_test_main.py`** - 综合集成测试
   - 测试所有核心功能
   - 包括系统初始化、音频设备、模型加载、语音命令、数字提取、TTS、键盘集成
   - 运行时间：约30-60秒
   - 生成详细日志文件

2. **`simple_integration_test.py`** - 简易集成测试
   - 快速基础功能验证
   - 提供测试模式和演示模式
   - 运行时间：约10-20秒
   - 适合快速检查系统状态

3. **`main_function_test.py`** - 主函数流程测试
   - 专门针对Mode 1语音识别功能
   - 测试主程序启动流程和状态管理
   - 运行时间：约15-25秒
   - 验证Mode 1的核心功能

4. **`voice_integration_main.py`** - 语音集成主函数测试
   - 生产环境级别的集成测试
   - 使用上下文管理器确保资源清理
   - 运行时间：约20-30秒
   - 最接近实际使用场景

### 专项测试

5. **`test_mode1_direct.py`** - Mode 1直接测试
   - 直接测试Mode 1功能，绕过菜单系统
   - 验证自动启动机制
   - 运行时间：约15秒

6. **`test_voice_improved.py`** - 改进版语音测试
   - 增强的语音识别测试
   - 更好的音频敏感度和详细输出
   - 运行时间：约15秒

7. **`test_voice_debug.py`** - 调试版语音测试
   - 提供详细的调试信息
   - 用于故障排除
   - 运行时间：约10秒

8. **`test_number_extraction.py`** - 数字提取测试
   - 专门测试中文数字提取功能
   - 验证cn2an库和正则表达式
   - 运行时间：约5秒

### 测试运行器

9. **`test_runner.py`** - 集成测试运行器
   - 统一运行所有测试
   - 提供测试分组和选择功能
   - 生成测试总结报告
   - 保存测试结果到文件

## 使用方法

### 快速开始

运行简易集成测试：
```bash
python simple_integration_test.py
```

### 综合测试

运行完整的集成测试：
```bash
python integration_test_main.py
```

### 使用测试运行器

运行所有测试：
```bash
python test_runner.py
```

选择特定测试：
```bash
python test_runner.py
# 然后选择选项 D，输入测试编号如: 1,3,5
```

### 专项测试

测试Mode 1功能：
```bash
python test_mode1_direct.py
```

测试数字提取：
```bash
python test_number_extraction.py
```

## 测试流程建议

### 首次测试
1. 运行 `simple_integration_test.py` 进行快速验证
2. 运行 `test_number_extraction.py` 验证数字提取
3. 运行 `test_mode1_direct.py` 验证Mode 1功能

### 深度测试
1. 运行 `test_runner.py` 选择选项 A (所有测试)
2. 查看生成的 `test_summary.txt` 报告
3. 检查 `voice_integration.log` 详细日志

### 故障排除
1. 运行 `test_voice_debug.py` 获取调试信息
2. 运行 `integration_test_main.py` 进行全面诊断
3. 查看各个测试生成的日志文件

## 预期结果

### 成功指标
- ✅ 系统初始化成功
- ✅ 音频设备检测到输入设备
- ✅ 语音模型加载成功
- ✅ 语音命令识别率 > 75%
- ✅ 数字提取成功率 > 60%
- ✅ TTS功能可用
- ✅ 实时语音识别有响应

### 通过标准
- **PASSED**: 80% 以上测试通过
- **PARTIAL**: 60-80% 测试通过
- **FAILED**: 低于60%测试通过

## 常见问题

### 音频设备检测失败
- 检查麦克风是否正确连接
- 检查系统音频设置
- 确保麦克风权限已开启

### 语音模型加载失败
- 检查模型文件路径
- 验证模型文件完整性
- 确保足够的内存空间

### 语音识别无响应
- 检查环境噪音
- 调整麦克风灵敏度
- 尝试不同的语音输入

### 数字提取失败
- 验证cn2an库安装
- 检查中文数字发音
- 测试简单的数字短语

## 日志文件

测试会生成以下日志文件：
- `integration_test.log` - 综合测试详细日志
- `voice_integration.log` - 语音集成测试日志
- `test_summary.txt` - 测试运行器总结报告

## 注意事项

1. **麦克风权限**: 确保系统允许Python访问麦克风
2. **环境噪音**: 在相对安静的环境中测试
3. **语音清晰**: 测试时说话要清晰、语速适中
4. **中文输入**: 测试语音命令和数字时使用中文
5. **超时处理**: 某些测试有超时机制，请按提示操作

## 故障报告

如果测试失败，请提供以下信息：
1. 运行的测试名称
2. 完整的错误输出
3. 生成的日志文件内容
4. 系统环境信息（操作系统、Python版本等）

## 更新记录

- v1.0: 基础集成测试套件
- v1.1: 添加主函数流程测试
- v1.2: 添加生产环境集成测试
- v1.3: 添加测试运行器和总结报告