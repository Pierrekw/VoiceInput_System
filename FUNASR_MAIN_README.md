# FunASR语音输入系统使用说明

## 🎯 系统概述

FunASR语音输入系统是一个基于阿里巴巴FunASR模型的智能语音识别系统，集成了：
- **高精度语音识别**：支持中文语音识别
- **智能文本处理**：自动转换中文数字为阿拉伯数字
- **实时控制功能**：支持键盘和语音命令控制
- **连续运行模式**：可持续识别和转换

## 🚀 快速开始

### 基本使用
```bash
python start_funasr.py
```

### 测试模式（10秒）
```bash
python test_main_f.py
```

## 🎮 控制方式

### 键盘控制
- **空格键**：暂停/恢复识别
- **ESC键**：完全停止程序

### 语音命令
- **暂停命令**：`"暂停"`、`"暂停录音"`、`"暂停识别"`、`"pause"`
- **恢复命令**：`"继续"`、`"继续录音"`、`"恢复"`、`"恢复识别"`、`"resume"`
- **停止命令**：`"停止"`、`"停止录音"`、`"结束"`、`"exit"`、`"stop"`

## 🧠 智能文本处理

### 数字识别规则
系统会智能区分不同类型的输入：

#### ✅ 纯数字输入（会转换）
```
三 二 一 点 五 → 321.5
一 百 二 十 三 → 123
```

#### ✅ 数字+单位输入（会转换）
```
三 十 七 度 → 37
一 百 元 → 100
五 米 → 5
```

#### ❌ 描述性文本（不转换数字）
```
我 和 猫 咪 一 起 出 去 → 我和猫咪一起出去
今 天 天 气 很 好 → 今天天气很好
```

### 转换规则
- **70%非数字规则**：如果文本中超过70%是非数字，不进行数字转换
- **纯数字识别**：只对纯数字或数字+单位进行转换
- **智能过滤**：避免在描述性文本中意外转换数字

## 📊 结果展示

### 实时显示
系统会实时显示：
```
识别的原文
转换后的数字 或 处理后的文本
```

### 运行汇总
程序结束后显示：
- 总识别次数
- 纯数字识别次数
- 文本识别次数
- 提取的数字列表
- 详细识别结果

## ⚙️ 系统特性

### 核心功能
- **静默模式**：隐藏技术细节，只显示识别结果
- **循环识别**：自动重启新识别周期
- **状态管理**：运行/暂停/停止状态切换
- **异常处理**：完善的错误处理和资源清理

### 技术特点
- **基于FunASR**：工业级语音识别准确度
- **智能文本处理**：使用cn2an库进行数字转换
- **多线程架构**：键盘监听和语音识别并行运行
- **资源管理**：自动加载和卸载模型

## 🔧 故障排除

### 常见问题

1. **初始化失败**
   - 检查FunASR模型是否正确下载到 `./model/fun/` 目录
   - 确认依赖包已完整安装
   - 验证麦克风设备正常工作

2. **ESC键失效**
   - 确保终端窗口处于活动状态
   - 尝试使用语音命令 `"停止"`

3. **识别无响应**
   - 检查麦克风权限
   - 确认音频设备工作正常
   - 尝试重新启动程序

### 系统要求
- Python 3.8+
- Windows系统（键盘监听功能）
- 麦克风设备
- FunASR模型文件

## 📁 文件说明

- `main_f.py` - 主程序模块
- `start_funasr.py` - 启动脚本（推荐使用）
- `test_main_f.py` - 测试脚本
- `funasr_voice_module.py` - FunASR语音识别模块
- `text_processor_clean.py` - 智能文本处理模块

## 🎉 使用示例

### 数字识别示例
```
输入：一 百 二 十 三 点 五
显示：123.5
```

### 文本处理示例
```
输入：我 和 猫 咪 一 起 出 去
显示：我和猫咪一起出去
```

### 控制命令示例
```
说出："暂停" → 系统暂停识别
说出："继续" → 系统恢复识别
按下ESC → 完全停止程序
```

---

*本系统集成了先进的FunASR语音识别技术和智能文本处理算法，为用户提供高效、准确的语音转文字和数字转换服务。*