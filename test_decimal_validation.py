#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
éªŒè¯å°æ•°å’Œç‰¹æ®Šæ•°å­—æ ¼å¼æ˜¯å¦å—æ–°è§„åˆ™å½±å“
"""

import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from text_processor import TextProcessor, VoiceCommandProcessor


def test_decimal_numbers():
    """æµ‹è¯•å°æ•°å’Œç‰¹æ®Šæ•°å­—æ ¼å¼"""
    processor = TextProcessor()
    command_processor = VoiceCommandProcessor()

    print("ğŸ§ª éªŒè¯å°æ•°å’Œç‰¹æ®Šæ•°å­—æ ¼å¼")
    print("=" * 80)
    print("ğŸ“‹ æµ‹è¯•ç›®çš„ï¼šéªŒè¯åŒ…å«å°æ•°ç‚¹çš„æ•°å­—ä¸å—ä¸¥æ ¼éªŒè¯è§„åˆ™å½±å“")
    print("=" * 80)

    # æµ‹è¯•ç”¨ä¾‹ï¼š(åŸå§‹æ–‡æœ¬, å¤„ç†åæ–‡æœ¬, æœŸæœ›ç»“æœ, è¯´æ˜)
    test_cases = [
        # ===== å°æ•°æ•°å­—ï¼ˆåº”è¯¥ä¿æŒåŸé€»è¾‘ï¼‰ =====
        ("23.23", "23.23", [23.23], "å°æ•°æ•°å­—ï¼Œåº”è¯¥æå–"),
        ("25.5", "25.5", [25.5], "å°æ•°æ•°å­—ï¼Œåº”è¯¥æå–"),
        ("100.5", "100.5", [100.5], "å°æ•°æ•°å­—ï¼ˆ100+å°æ•°ï¼‰ï¼Œåº”è¯¥æå–"),
        ("200.25", "200.25", [200.25], "å°æ•°æ•°å­—ï¼ˆ200+å°æ•°ï¼‰ï¼Œåº”è¯¥æå–"),

        # ===== æ–‡æœ¬ä¸­çš„å°æ•°ï¼ˆåº”è¯¥æå–ï¼‰ =====
        ("ä»·æ ¼23.23å…ƒ", "ä»·æ ¼23.23å…ƒ", [23.23], "æ–‡æœ¬ä¸­çš„å°æ•°ï¼Œåº”è¯¥æå–"),
        ("é•¿åº¦ä¸º25.5æ¯«ç±³", "é•¿åº¦ä¸º25.5æ¯«ç±³", [25.5], "æ–‡æœ¬ä¸­çš„å°æ•°ï¼Œåº”è¯¥æå–"),
        ("é‡é‡100.5å…¬æ–¤", "é‡é‡100.5å…¬æ–¤", [100.5], "æ–‡æœ¬ä¸­çš„å°æ•°ï¼Œåº”è¯¥æå–"),

        # ===== æ··åˆæ–‡æœ¬ä¸­çš„å°æ•°ï¼ˆåº”è¯¥æå–ï¼‰ =====
        ("æ¸©åº¦23.23é‡é‡25.5", "æ¸©åº¦23.23é‡é‡25.5", [23.23, 25.5], "æ··åˆæ–‡æœ¬ä¸­çš„å°æ•°ï¼Œåº”è¯¥éƒ½æå–"),
        ("ä»·æ ¼100.23é•¿åº¦200.5", "ä»·æ ¼100.23é•¿åº¦200.5", [100.23, 200.5], "æ··åˆæ–‡æœ¬ä¸­çš„å°æ•°ï¼Œåº”è¯¥éƒ½æå–"),

        # ===== ç‰¹æ®Šæ•°å­—æ ¼å¼ï¼ˆåº”è¯¥ä¿æŒåŸé€»è¾‘ï¼‰ =====
        ("0.5", "0.5", [0.5], "å°äº1çš„å°æ•°ï¼Œåº”è¯¥æå–"),
        ("10.01", "10.01", [10.01], "ä¸¤ä½å°æ•°ï¼Œåº”è¯¥æå–"),
        ("1000.001", "1000.001", [1000.001], "ä¸‰ä½å°æ•°ï¼Œåº”è¯¥æå–"),

        # ===== å¯¹æ¯”ï¼š100æ•´æ•°å€æ•°åœ¨æ–‡æœ¬ä¸­ï¼ˆåº”è¯¥è·³è¿‡ï¼‰ =====
        ("ä»·æ ¼100å…ƒ", "ä»·æ ¼100å…ƒ", [], "100æ•´æ•°å€æ•°åœ¨æ–‡æœ¬ä¸­ï¼Œåº”è¯¥è·³è¿‡"),
        ("é•¿åº¦ä¸º200æ¯«ç±³", "é•¿åº¦ä¸º200æ¯«ç±³", [], "200æ•´æ•°å€æ•°åœ¨æ–‡æœ¬ä¸­ï¼Œåº”è¯¥è·³è¿‡"),

        # ===== å¯¹æ¯”ï¼š100æ•´æ•°å€æ•°çº¯æ•°å­—ï¼ˆåº”è¯¥æå–ï¼‰ =====
        ("100", "100", [100.0], "100çº¯æ•°å­—ï¼Œåº”è¯¥æå–"),
        ("200", "200", [200.0], "200çº¯æ•°å­—ï¼Œåº”è¯¥æå–"),
    ]

    passed = 0
    failed = 0

    for i, (original, processed, expected, description) in enumerate(test_cases, 1):
        print(f"\nğŸ“ æµ‹è¯• {i:2d}: {description}")
        print(f"   åŸå§‹: '{original}' -> å¤„ç†: '{processed}'")

        result = processor.extract_numbers(original, processed, command_processor)

        if result == expected:
            print(f"   âœ… é€šè¿‡: {result}")
            passed += 1
        else:
            print(f"   âŒ å¤±è´¥: æœŸæœ› {expected}, å®é™…å¾—åˆ° {result}")
            failed += 1

    print("\n" + "=" * 80)
    print(f"ğŸ“Š æµ‹è¯•ç»“æœ: {passed} é€šè¿‡, {failed} å¤±è´¥")
    print()

    # å…³é”®éªŒè¯
    decimal_passed = True
    for i, (original, processed, expected, description) in enumerate(test_cases, 1):
        if "å°æ•°" in description:
            if expected == []:
                print(f"âŒ é”™è¯¯ï¼šå°æ•°æ•°å­—è¢«é”™è¯¯è·³è¿‡ï¼'{original}' -> {expected}")
                decimal_passed = False

    if decimal_passed:
        print("âœ… å…³é”®éªŒè¯ï¼šæ‰€æœ‰å°æ•°æ•°å­—å‡æœªè¢«é”™è¯¯è·³è¿‡")
        print("âœ… æ–°è§„åˆ™å¯¹å°æ•°æ•°å­—æ— å½±å“ï¼Œä¿æŒåŸæ¥é€»è¾‘")
    else:
        print("âŒ é—®é¢˜ï¼šå°æ•°æ•°å­—å—åˆ°æ–°è§„åˆ™å½±å“ï¼")

    if failed == 0 and decimal_passed:
        print("\n" + "ğŸ‰" * 40)
        print("âœ… éªŒè¯æˆåŠŸï¼å°æ•°å’Œç‰¹æ®Šæ•°å­—æ ¼å¼å®Œå…¨ä¸å—æ–°è§„åˆ™å½±å“ï¼")
        print("ğŸ‰" * 40)
    else:
        print("\n" + "âš ï¸" * 40)
        print("âŒ éªŒè¯å¤±è´¥ï¼å­˜åœ¨å°æ•°æ•°å­—è¢«é”™è¯¯å¤„ç†ï¼")
        print("âš ï¸" * 40)

    return failed == 0 and decimal_passed


if __name__ == "__main__":
    success = test_decimal_numbers()
    sys.exit(0 if success else 1)
