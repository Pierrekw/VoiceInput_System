#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ä¸¥æ ¼æ•°å­—æå–éªŒè¯æµ‹è¯•
æµ‹è¯•æ–°å¢çš„ä¸¥æ ¼éªŒè¯è§„åˆ™ï¼šåªæå–çº¯æ•°å­—ï¼Œè·³è¿‡æ–‡æœ¬ä¸Šä¸‹æ–‡ä¸­çš„100å€æ•°
"""

import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from text_processor import TextProcessor, VoiceCommandProcessor


def test_comprehensive_validation():
    """ç»¼åˆæµ‹è¯•ä¸¥æ ¼éªŒè¯è§„åˆ™"""
    processor = TextProcessor()
    command_processor = VoiceCommandProcessor()

    print("ğŸ§ª ç»¼åˆæµ‹è¯•ä¸¥æ ¼æ•°å­—æå–éªŒè¯")
    print("=" * 80)

    # æµ‹è¯•ç”¨ä¾‹ï¼š(åŸå§‹æ–‡æœ¬, å¤„ç†åæ–‡æœ¬, æœŸæœ›ç»“æœ, åˆ†ç±»)
    test_cases = [
        # ===== ç±»åˆ«1ï¼šçº¯æ•°å­—è¾“å…¥ï¼ˆåº”è¯¥æå–ï¼‰ =====
        ("100", "100", [100.0], "çº¯æ•°å­—è¾“å…¥"),
        ("200", "200", [200.0], "çº¯æ•°å­—è¾“å…¥"),
        ("1300", "1300", [1300.0], "çº¯æ•°å­—è¾“å…¥"),
        ("50", "50", [50.0], "çº¯æ•°å­—è¾“å…¥ï¼ˆé100å€æ•°ï¼‰"),
        ("25.5", "25.5", [25.5], "çº¯å°æ•°è¾“å…¥"),

        # ===== ç±»åˆ«2ï¼šæ–‡æœ¬ä¸Šä¸‹æ–‡ä¸­çš„100å€æ•°ï¼ˆä¸åº”è¯¥æå–ï¼‰ =====
        ("åƒé¥­200", "åƒé¥­200", [], "æ–‡æœ¬ä¸­çš„100å€æ•°"),
        ("ä»·æ ¼ä¸º300å…ƒ", "ä»·æ ¼ä¸º300å…ƒ", [], "æ–‡æœ¬ä¸­çš„100å€æ•°"),
        ("é•¿åº¦400æ¯«ç±³", "é•¿åº¦400æ¯«ç±³", [], "æ–‡æœ¬ä¸­çš„100å€æ•°"),
        ("æ€»å…±500ä¸ª", "æ€»å…±500ä¸ª", [], "æ–‡æœ¬ä¸­çš„100å€æ•°"),
        ("é«˜åº¦600ç±³", "é«˜åº¦600ç±³", [], "æ–‡æœ¬ä¸­çš„100å€æ•°"),
        ("æ¸©åº¦700åº¦", "æ¸©åº¦700åº¦", [], "æ–‡æœ¬ä¸­çš„100å€æ•°"),
        ("é‡é‡800å…¬æ–¤", "é‡é‡800å…¬æ–¤", [], "æ–‡æœ¬ä¸­çš„100å€æ•°"),
        ("è·ç¦»900å…¬é‡Œ", "è·ç¦»900å…¬é‡Œ", [], "æ–‡æœ¬ä¸­çš„100å€æ•°"),
        ("æ•°é‡1000ä»¶", "æ•°é‡1000ä»¶", [], "æ–‡æœ¬ä¸­çš„100å€æ•°"),

        # ===== ç±»åˆ«3ï¼šæ··åˆæ•°å­—ï¼ˆåªæå–é100å€æ•°ï¼‰ =====
        ("ä»·æ ¼200é•¿åº¦50", "ä»·æ ¼200é•¿åº¦50", [50.0], "æ··åˆæ•°å­—"),
        ("æ¸©åº¦100é‡é‡25", "æ¸©åº¦100é‡é‡25", [25.0], "æ··åˆæ•°å­—"),
        ("é«˜åº¦300å®½åº¦150", "é«˜åº¦300å®½åº¦150", [150.0], "æ··åˆæ•°å­—"),

        # ===== ç±»åˆ«4ï¼šè¯­éŸ³å‘½ä»¤ï¼ˆä¸åº”è¯¥è¢«æå–ï¼‰ =====
        ("åˆ‡æ¢åˆ°200", "åˆ‡æ¢åˆ°200", [], "æ ‡å‡†åºå·å‘½ä»¤"),
        ("è®¾ç½®åºå·300", "è®¾ç½®åºå·300", [], "æ ‡å‡†åºå·å‘½ä»¤"),
        ("åˆ‡æ¢åºå·400", "åˆ‡æ¢åºå·400", [], "æ ‡å‡†åºå·å‘½ä»¤"),

        # ===== ç±»åˆ«5ï¼šä¸­æ–‡æ•°å­—è½¬æ¢ =====
        ("äºŒç™¾", "200", [200.0], "çº¯ä¸­æ–‡æ•°å­—è½¬æ¢"),
        ("ä¸€åƒä¸‰ç™¾", "1300", [1300.0], "çº¯ä¸­æ–‡æ•°å­—è½¬æ¢"),
        ("é•¿åº¦äºŒç™¾", "é•¿åº¦200", [], "æ–‡æœ¬ä¸­çš„ä¸­æ–‡æ•°å­—è½¬æ¢"),
        ("é‡é‡ä¸‰ç™¾å…¬æ–¤", "é‡é‡300å…¬æ–¤", [], "æ–‡æœ¬ä¸­çš„ä¸­æ–‡æ•°å­—è½¬æ¢"),

        # ===== ç±»åˆ«6ï¼šå¤æ‚æƒ…å†µ =====
        ("äº§å“Aä»·æ ¼200æ•°é‡50", "äº§å“Aä»·æ ¼200æ•°é‡50", [50.0], "å¤æ‚æ··åˆæ–‡æœ¬"),
        ("è®¢å•å·100æ€»é‡‘é¢500", "è®¢å•å·100æ€»é‡‘é¢500", [], "å¤æ‚æ··åˆæ–‡æœ¬ï¼ˆæ€»é‡‘é¢å‰çš„500è¢«è·³è¿‡ï¼‰"),

        # ===== ç±»åˆ«7ï¼šè¾¹ç•Œæƒ…å†µ =====
        ("", "", [], "ç©ºæ–‡æœ¬"),
        ("æ— æ•°å­—æ–‡æœ¬", "æ— æ•°å­—æ–‡æœ¬", [], "æ— æ•°å­—æ–‡æœ¬"),
        ("1", "1", [1.0], "å•ä¸ªæ•°å­—"),
        ("100", "100", [100.0], "100å€æ•°ï¼ˆçº¯æ•°å­—ï¼‰"),
        ("x100", "x100", [], "100å€æ•°ï¼ˆå‰ç¼€ï¼‰"),
        ("100x", "100x", [], "100å€æ•°ï¼ˆåç¼€ï¼‰"),
    ]

    passed = 0
    failed = 0
    failed_tests = []

    for i, (original, processed, expected, category) in enumerate(test_cases, 1):
        print(f"\nğŸ“ æµ‹è¯• {i:2d} [{category}]:")
        print(f"   åŸå§‹: '{original}' -> å¤„ç†: '{processed}'")

        result = processor.extract_numbers(original, processed, command_processor)

        if result == expected:
            print(f"   âœ… é€šè¿‡: {result}")
            passed += 1
        else:
            print(f"   âŒ å¤±è´¥: æœŸæœ› {expected}, å®é™…å¾—åˆ° {result}")
            failed += 1
            failed_tests.append((i, category, original, processed, expected, result))

    # ç»Ÿè®¡ä¿¡æ¯
    print("\n" + "=" * 80)
    print(f"ğŸ“Š æµ‹è¯•ç»Ÿè®¡:")
    print(f"   æ€»æµ‹è¯•æ•°: {len(test_cases)}")
    print(f"   é€šè¿‡: {passed} âœ…")
    print(f"   å¤±è´¥: {failed} âŒ")
    print(f"   æˆåŠŸç‡: {passed/len(test_cases)*100:.1f}%")

    # æ˜¾ç¤ºå¤±è´¥çš„æµ‹è¯•
    if failed_tests:
        print(f"\nâŒ å¤±è´¥çš„æµ‹è¯•è¯¦æƒ…:")
        for test_num, category, original, processed, expected, result in failed_tests:
            print(f"   [{category}] '{original}' -> '{processed}'")
            print(f"      æœŸæœ›: {expected}, å®é™…: {result}")

    if failed == 0:
        print("\nâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ä¸¥æ ¼éªŒè¯è§„åˆ™å·¥ä½œå®Œç¾ï¼")
    else:
        print(f"\nâš ï¸  æœ‰ {failed} ä¸ªæµ‹è¯•å¤±è´¥")

    return failed == 0


def test_edge_cases():
    """æµ‹è¯•è¾¹ç•Œæƒ…å†µ"""
    processor = TextProcessor()
    command_processor = VoiceCommandProcessor()

    print("\n" + "=" * 80)
    print("ğŸ§ª è¾¹ç•Œæƒ…å†µæµ‹è¯•")
    print("=" * 80)

    edge_cases = [
        # æµ‹è¯•å‘¨å›´çš„å­—ç¬¦æ•°
        ("a200", "a200", [], "1ä¸ªå·¦å­—ç¬¦ï¼ˆæ–‡æœ¬ä¸Šä¸‹æ–‡ï¼Œè·³è¿‡ï¼‰"),
        ("ab200", "ab200", [], "2ä¸ªå·¦å­—ç¬¦ï¼ˆæ–‡æœ¬ä¸Šä¸‹æ–‡ï¼Œè·³è¿‡ï¼‰"),
        ("200a", "200a", [], "1ä¸ªå³å­—ç¬¦ï¼ˆæ–‡æœ¬ä¸Šä¸‹æ–‡ï¼Œè·³è¿‡ï¼‰"),
        ("200ab", "200ab", [], "2ä¸ªå³å­—ç¬¦ï¼ˆæ–‡æœ¬ä¸Šä¸‹æ–‡ï¼Œè·³è¿‡ï¼‰"),
        ("a200b", "a200b", [], "å·¦å³å„1ä¸ªå­—ç¬¦ï¼ˆæ–‡æœ¬ä¸Šä¸‹æ–‡ï¼Œè·³è¿‡ï¼‰"),
        ("ab200cd", "ab200cd", [], "å·¦å³å„2ä¸ªå­—ç¬¦ï¼ˆæ–‡æœ¬ä¸Šä¸‹æ–‡ï¼Œè·³è¿‡ï¼‰"),

        # æµ‹è¯•è´Ÿæ•°ï¼ˆè´Ÿå·åœ¨æ­£åˆ™åŒ¹é…æ—¶è¢«è¿‡æ»¤ï¼‰
        ("-100", "-100", [100.0], "è´Ÿ100å€æ•°ï¼ˆæå–ç»å¯¹å€¼ï¼‰"),
        ("æ¸©åº¦-100åº¦", "æ¸©åº¦-100åº¦", [], "è´Ÿ100å€æ•°ï¼ˆæ–‡æœ¬ä¸­ï¼Œè·³è¿‡ï¼‰"),

        # æµ‹è¯•å°æ•°
        ("200.5", "200.5", [200.5], "å¸¦å°æ•°ç‚¹çš„100å€æ•°ï¼ˆåº”è¯¥æå–ï¼‰"),
        ("ä»·æ ¼200.5å…ƒ", "ä»·æ ¼200.5å…ƒ", [200.5], "æ–‡æœ¬ä¸­çš„å¸¦å°æ•°ç‚¹æ•°ï¼ˆæå–ï¼‰"),

        # æµ‹è¯•å¤šä¸ªæ•°å­—ï¼ˆè¢«å…¶ä»–æ•°å­—åŒ…å›´çš„100å€æ•°ä¹Ÿä¼šè¢«è·³è¿‡ï¼‰
        ("100 200 300", "100 200 300", [], "å¤šä¸ªç©ºæ ¼åˆ†éš”çš„100å€æ•°ï¼ˆäº’ç›¸åŒ…å›´ï¼Œè·³è¿‡ï¼‰"),
        ("a100 b200 c300", "a100 b200 c300", [], "å¤šä¸ª100å€æ•°ï¼ˆåœ¨æ–‡æœ¬ä¸­ï¼Œè·³è¿‡ï¼‰"),
    ]

    passed = 0
    failed = 0

    for i, (original, processed, expected, description) in enumerate(edge_cases, 1):
        print(f"\nğŸ“ è¾¹ç•Œæµ‹è¯• {i}: {description}")
        print(f"   åŸå§‹: '{original}' -> å¤„ç†: '{processed}'")

        result = processor.extract_numbers(original, processed, command_processor)

        if result == expected:
            print(f"   âœ… é€šè¿‡: {result}")
            passed += 1
        else:
            print(f"   âŒ å¤±è´¥: æœŸæœ› {expected}, å®é™…å¾—åˆ° {result}")
            failed += 1

    print("\n" + "=" * 80)
    print(f"ğŸ“Š è¾¹ç•Œæµ‹è¯•ç»“æœ: {passed} é€šè¿‡, {failed} å¤±è´¥")

    return failed == 0


if __name__ == "__main__":
    success1 = test_comprehensive_validation()
    success2 = test_edge_cases()

    if success1 and success2:
        print("\n" + "ğŸ‰" * 40)
        print("âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ä¸¥æ ¼éªŒè¯è§„åˆ™å®Œç¾å·¥ä½œï¼")
        print("ğŸ‰" * 40)
        sys.exit(0)
    else:
        print("\n" + "âš ï¸" * 40)
        print("âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥")
        print("âš ï¸" * 40)
        sys.exit(1)
